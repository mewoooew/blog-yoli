---
title: "#Pagefind ä¸ºé™æ€åšå®¢é…ç½®ç«™å†…æœç´¢å·¥å…·"
date: 2023-08-06T20:18:13+08:00
lastmod: 2023-08-06T20:18:13+08:00
draft: false
tags: []
categories: ["pocket-book"]
authors:
- "mewooew"
---

### åº æ–¹æ¡ˆé€‰æ‹©

`hugo`å®˜ç½‘æ–‡ç« [Search for your Hugo Website](https://gohugo.io/tools/search/)ä»‹ç»äº†å‡ ç§ä¸ºé™æ€ç½‘ç«™æ·»åŠ å…¨æ–‡æ£€ç´¢åŠŸèƒ½çš„æ–¹æ³•ã€‚å…¶ä¸­æ¯”è¾ƒæœ‰ç‰¹è‰²çš„æœç´¢å·¥å…·æœ‰åŸºäºå€’æŒ‚ç´¢å¼•(`inverted index`)çš„`lunr.js`å’Œ`Fuse.js`, äºŒè€…éƒ½æ˜¯ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„å…¨æ–‡æœç´¢å·¥å…·, åè€…è¿˜å…·æœ‰æ¨¡ç³ŠæŸ¥è¯¢çš„åŠŸèƒ½. ä¸è¿‡äºŒè€…åœ¨æœç´¢æ—¶éœ€è¦æµè§ˆå™¨æŠŠæ‰€æœ‰æ–‡ç« è¯·æ±‚ä¸‹æ¥, å»ºç«‹å€’æŒ‚ç´¢å¼•`index.json`, å†å¯¹ç´¢å¼•è¿›è¡Œæœç´¢, éšç€ç½‘ç«™å†…å®¹å¢åŠ , `index.json`çš„ä½“ç§¯ä¼šè¶Šæ¥è¶Šå¤§, ä¼šå¯¼è‡´ç½‘ç»œè¯·æ±‚å»¶æ—¶, è‹¥è€ƒè™‘ç”Ÿæˆ`index.json`æ—¶åªè¾“å‡ºæ ‡é¢˜ç­‰å…³é”®å­—, ä¼šå¯¼è‡´æœç´¢è´¨é‡å¤§å¹…ä¸‹é™. å› æ­¤å°†ç›®å…‰è½¬å‘äº†[pagefind](https://pagefind.app/) æœç´¢å·¥å…·. 

`Pagefind`æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·, `Pagefind`æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å‘½ä»¤è¡Œå·¥å…·, å…¶åŸç†æ˜¯ï¼šè¿è¡Œ`Pagefind`å‘½ä»¤, æ‰«ææ‰€æœ‰é™æ€ç½‘é¡µå¹¶ç”Ÿæˆç´¢å¼•; ç”¨æˆ·æœç´¢æ—¶, é€šè¿‡ç½‘é¡µä¸­å†…åµŒçš„`JavaScript`è„šæœ¬æ¥è®¿é—®é¢„å…ˆç”Ÿæˆçš„ç´¢å¼•ï¼Œä»è€Œå®ç°é™æ€å…¨æ–‡æ£€ç´¢ã€‚[^ç™½æ±¤å››ç‰©] ä¹Ÿå°±æ˜¯è¯´, ç½‘ç«™å†…å®¹çš„ç´¢å¼•å®åœ¨ç”Ÿæˆç½‘ç«™ä¹‹å‰å°±å·²ç»å®Œæˆäº†, æ— éœ€æµè§ˆå™¨è¿›è¡Œç”Ÿæˆ, å‡å°‘äº†åæœŸç½‘ç»œè¯·æ±‚å»¶æ—¶çš„é¡¾è™‘. è€Œä¸”åœ¨ä½¿ç”¨äº†`GitHub Action`çš„å‰æä¸‹, `Pagefind`ç”Ÿæˆç´¢å¼•çš„æ­¥éª¤ä¹Ÿå¯ä»¥é›†æˆåˆ°åšå®¢éƒ¨ç½²çš„å·¥ä½œæµä¸­, ä¸å¿…æ¯æ¬¡ç”Ÿæˆç½‘ç«™éƒ½è¦è¿è¡Œä¸€é`Pagefind`.

[^ç™½æ±¤å››ç‰©]:[ç™½æ±¤å››ç‰©: ä¸º Hugo é™æ€ç½‘ç«™æ·»åŠ å…¨æ–‡æ£€ç´¢åŠŸèƒ½](https://www.fournoas.com/posts/adding-full-text-search-to-a-hugo-static-website/)

[pagefind](https://pagefind.app/) æ˜¯é€šè¿‡åˆ†è¯çš„æ–¹å¼æ¥è¿›è¡Œæœç´¢çš„, æ‰€ä»¥æœç´¢åŠŸèƒ½åªä¼šåœ¨å‘½ä¸­åˆ†è¯çš„æ—¶å€™ç”Ÿæ•ˆ. æ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªè¯ ç¢³é…¸å±æœº, æœç´¢`ç¢³é…¸` \ `å±æœº`æˆ–è€…`ç¢³é…¸ å±æœº`éƒ½å¯ä»¥æœåˆ°å¯¹åº”çš„å†…å®¹, ä½†æ˜¯ç›´æ¥æœç´¢`ç¢³é…¸å±æœº`ä¼šå¾—ä¸åˆ°ä»»ä½•æœç´¢ç»“æœ, è¿™å°±æ˜¯åˆ†è¯å¯¼è‡´çš„.

è¿™ç§åˆ†è¯çš„ä¼˜åŠ¿æ˜¯å¯ä»¥å¤§å¤§å‡å°‘ç´¢å¼•æ–‡ä»¶çš„å¤§å°, `hugo`é»˜è®¤ç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶åŒ…å«äº†æ¯ç¯‡æ–‡ç« çš„å…¨æ–‡, éšç€æ–‡ç« çš„å¢å¤šç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶ä¼šè†¨èƒ€çš„æ¯”è¾ƒå¿«, è€Œ`pagefind`è¿™ç§é€šè¿‡åˆ†è¯ç”Ÿæˆç´¢å¼•æ–‡ä»¶çš„æ–¹å¼, åªä¼šåœ¨æœ‰æ–°çš„åˆ†è¯çš„æ—¶å€™æˆ–è€…æ–°çš„æ–‡ç« çš„æ—¶å€™(å› ä¸ºéœ€è¦è®°å½•åˆ†è¯å¯¹åº”çš„æ–‡ç« çš„ä¸€äº›ä¿¡æ¯, æ¯”å¦‚é“¾æ¥)ç´¢å¼•æ–‡ä»¶çš„å¤§å°æ‰ä¼šæœ‰äº›å¾®å¢åŠ , ç”Ÿæˆçš„ç´¢å¼•æ–‡ä»¶è†¨èƒ€çš„å°±ä¼šæ…¢å¾ˆå¤š.[^ç‚¹åŠä¹]

[^ç‚¹åŠä¹]:[ç‚¹åŠä¹: ç»™æˆ‘çš„blogåŠ ä¸Šæœç´¢åŠŸèƒ½](https://www.dianbanjiu.com/post/%E7%BB%99%E6%88%91%E7%9A%84blog%E5%8A%A0%E4%B8%8A%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/)

åœ¨`hugo`ä¸­è°ƒç”¨`Pagefind`çš„æ–¹å¼é€šå¸¸ä¸ºåœ¨è‡ªå®šä¹‰`html`é¡µé¢æ¨¡æ¿æˆ–è€…è‡ªå®šä¹‰å¼•å…¥`shortcode`,å†åœ¨æœç´¢é¡µé¢`markdown`æ–‡æ¡£å¼•å…¥ç›¸å…³ä»£ç ,è¿™é‡Œå›¾çœäº‹å‚è€ƒäº†åŒä¸€ä¸»é¢˜`hugo-theme-den`çš„ä½¿ç”¨è€…[pseudoyu](https://www.pseudoyu.com/zh/search/)ä½œè€…çš„ä»£ç ,ä½¿ç”¨shortcodeçš„æ–¹å¼, åŒæ—¶è¿˜ç»“åˆäº†[ç™½æ±¤å››ç‰©](https://www.fournoas.com/posts/adding-full-text-search-to-a-hugo-static-website/) \ [ç‚¹åŠä¹](https://www.dianbanjiu.com/post/%E7%BB%99%E6%88%91%E7%9A%84blog%E5%8A%A0%E4%B8%8A%E6%90%9C%E7%B4%A2%E5%8A%9F%E8%83%BD/)ç­‰ä½œè€…çš„æ•™ç¨‹äº†è§£äº†å®ç°ç«™å†…æ£€ç´¢åŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„. 

### å®‰è£…Pagefindå¹¶ç”Ÿæˆé™æ€ç´¢å¼•

é¦–å…ˆé€šè¿‡æ‰‹åŠ¨å‘å¸ƒå®ç°`Pagefind`æœç´¢åŠŸèƒ½, ä»¥ä¾¿äºåœ¨æœ¬åœ°è¿›è¡Œ`debug`, ä¹‹åå†è€ƒè™‘æ•´åˆè¿›`GitHub Action`å·¥ä½œæµ.

* å®‰è£…å¹¶å‘å¸ƒ

  åœ¨åšå®¢æ ¹ç›®å½•`blog-yoli/`ä¸‹é€šè¿‡å‘½ä»¤è¡Œå·¥å…·`npm`å®‰è£…`Pagefind`å·¥å…·å¹¶å‘å¸ƒ`hugo`ç«™ç‚¹(ç«™ç‚¹é™æ€æ–‡ä»¶é»˜è®¤æ˜¯å‘å¸ƒåˆ°`blog-yoli/public`æ–‡ä»¶å¤¹ä¸‹):

  ```shell
  npm i pagefind
  hugo
  ```

* ç”Ÿæˆç´¢å¼•

  æ‰«æ`public`æ–‡ä»¶å¤¹, ç”Ÿæˆ`Pagefind`ç´¢å¼•, å¹¶æ”¾åˆ°`blog-yoli/public/search`ç›®å½•ä¸‹(ä¸å¿…è‡ªå·±æ–°å»º, æŒ‡å®š`--bundle`å‚æ•°å, æ²¡æœ‰è¿™ä¸ªç›®å½•çš„è¯`Pagefind`ä¼šè‡ªå·±ç”Ÿæˆ)

  ```shell
  npx pagefind --source public --bundle-dir search
  ```

  ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å®ç°ç›¸åŒçš„æ“ä½œ:

  ```yaml
  # Pagefind ä¼šè‡ªåŠ¨åœ¨å½“å‰ç›®å½•ä¸‹æŸ¥æ‰¾pagefind.ymlé…ç½®æ–‡ä»¶ï¼Œ
  # ä½¿ç”¨å‚æ•°æˆ–é…ç½®æ–‡ä»¶çš„æ•ˆæœæ˜¯ç­‰ä»·çš„
  # åœ¨æ ¹ç›®å½•blog-yoliä¸‹æ–°å»ºpagefind.ymlé…ç½®æ–‡ä»¶,æ·»åŠ ä¿å­˜ä»¥ä¸‹è§„åˆ™:
  source: public
  bundle_dir: search
  ```

  è¿™æ ·ä¹‹åæ¯æ¬¡åªéœ€è¦ç›´æ¥è¿è¡Œ, å°±èƒ½æ›´æ–°ç´¢å¼•æ–‡ä»¶, å¹¶æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡å®šç›®å½•ä¸‹:

  ```shell
  npx pagefind
  ```

  >`Pagefind`é»˜è®¤å­˜æ”¾é™æ€æ–‡ä»¶çš„æ–‡ä»¶å¤¹åä¸º`_pagefind`, æ¯æ¬¡ç”Ÿæˆé™æ€ç´¢å¼•æ–‡ä»¶å, `Pagefind`ä¼šå°†ç´¢å¼•æ–‡ä»¶æ”¾å…¥`blog-yoli/public/_pagefind/`ç›®å½•ä¸‹, ä½†ä¸ºäº†é¿å…ä¹‹åå°†ç½‘ç«™éƒ¨ç½²åˆ°`GitHub Pages`ä¸Šæ—¶, `GitHub`å¯èƒ½ä¼šå¿½ç•¥\_å¼€å¤´çš„æ–‡ä»¶, æ‰€ä»¥æœ€å¥½è‡ªå·±æŒ‡å®šä¸€ä¸ªæ–‡ä»¶å¤¹å, æ¯”å¦‚è¿™é‡Œçš„`search`, ä¹‹åé™æ€ç´¢å¼•æ–‡ä»¶å°†å­˜æ”¾åœ¨`blog-yoli/public/search/`ç›®å½•ä¸‹.

### åœ¨é™æ€ç½‘é¡µä¸­æ·»åŠ æœç´¢å…¥å£

* åˆ›å»º`html`æ ¼å¼çš„`shortcodes`æ–‡ä»¶

  åœ¨`/blog-yoli/layouts/shortcodes/`ç›®å½•ä¸‹æ–°å»º`search.html`æ¨¡æ¿æ–‡ä»¶,è¾“å…¥ä¿å­˜ä»¥ä¸‹ä»£ç :

  ```html
  <link href="/search/pagefind-ui.css" rel="stylesheet">
  <script src="/search/pagefind-ui.js" type="text/javascript"></script>
  
  <div id="search"></div>
  <script>
      window.addEventListener('DOMContentLoaded', (event) => {
          new PagefindUI({ element: "#search" });
      });
  </script>
  ```

  å…¶ä¸­é“¾æ¥ç›®å½•çš„æ–‡ä»¶å¤¹è¦ä¸ä¹‹å‰è®¾ç½®çš„ç´¢å¼•é™æ€æ–‡ä»¶å­˜æ”¾çš„æ–‡ä»¶å¤¹åç›¸ä¸€è‡´,æ¯”å¦‚æ­¤å¤„ä¸º`search`

* åˆ›å»ºæœç´¢é¡µé¢

  åœ¨`/content/zh/`(å¼„å®Œåå¯ä»¥`en`ç›®å½•ä¸‹åŸæ ·copyè¿‡å»)ç›®å½•ä¸‹æ–°å»ºæ–‡æ¡£`search.md`æ–‡æ¡£ä½œä¸ºæ˜¾ç¤ºåœ¨ç½‘ç«™ä¸Šçš„æœç´¢é¡µé¢:

  ```shell
  hugo new search.md
  ```

  å¹¶åœ¨`search.md`æ–‡æ¡£ä¸­æ­£æ–‡å¤„æ·»åŠ ä»¥ä¸‹å†…å®¹ä½œä¸ºå±•ç¤ºåœ¨æœç´¢é¡µé¢ä¸Šçš„æœç´¢æ¡†(å› ä¸ºç›´æ¥å±•ç¤ºä»£ç ä¼šè¢«hugoä»¥ä¸ºè¦æ‰§è¡Œè€Œä¸æ˜¾ç¤º, æ‰€ä»¥è¿™é‡Œå±•ç¤ºçš„æ˜¯éœ€è¦è¾“å…¥çš„ä»£ç ç‰‡æ®µçš„å›¾ç‰‡):

  ![image-20230806220255292](https://cdn.jsdelivr.net/gh/mewoooew/picGO@main/images/hugo-pagefind-search-md.png)

  æ–‡ä»¶å¤´çš„å‚æ•°è®¾ç½®ä¸­(æ²¡æœ‰çš„åŠè‡ªå·±æ·»åŠ )è¦æ³¨æ˜è¦åœ¨ä¸»èœå•`main`ä¸­æ·»åŠ é¡µé¢å…¥å£, ä»¥åŠæƒé‡`weight`(å†³å®šé¡µé¢å…¥å£åœ¨èœå•æ çš„ä½ç½®å…ˆå, è¿™æ ·å°±æ— éœ€åœ¨ç½‘ç«™é…ç½®æ–‡ä»¶`config.toml`ä¸­å¦è¡Œç¼–è¾‘èœå•è®¾ç½®è§„åˆ™äº†), å¹¶ä¸”ä¸è¦ç¼–å…¥rssè®¢é˜…å†…å®¹`rss_ignore`:

  ```markdown
  ---
  title: "æœç´¢"
  date: "ä¸è¦æ”¹, hugoä¼šè‡ªå·±ç”Ÿæˆ"
  menu: "main"
  weight: 110 (è§†å…·ä½“æƒ…å†µä¿®æ”¹)
  rss_ignore: true
  ---
  ```

* æ•ˆæœé¢„è§ˆ

  å¼•å…¥`Pagefind`çŸ­ä»£ç çš„é™æ€ç½‘é¡µåœ¨æœ¬åœ°æœåŠ¡å™¨è¿›è¡Œé¢„è§ˆ`hugo server -D`æ—¶æ˜¯ä¸æ˜¾ç¤ºçš„, è¦çœ‹æ•ˆæœçš„è¯éœ€è¦åœ¨æ­£å¼æ¨é€åˆ°æœåŠ¡ç«¯ä¹‹åæ‰èƒ½çœ‹åˆ°.

### æ•´åˆå…¥GitHub Actionå·¥ä½œæµ

* æ·»åŠ `Pagefind`ç”Ÿæˆç´¢å¼•æ­¥éª¤

  ç¼–è¾‘ `/blog-yoli/.github/workflows/hugo.yml` æ–‡ä»¶, åœ¨ `steps` å°èŠ‚ä¸­çš„ `Build` å’Œ `Deploy` æ“ä½œä¹‹é—´æ·»åŠ å¦‚ä¸‹å†…å®¹:

  ```yaml
  - name: Install nodejs
      uses: actions/setup-node@v3
      with:
        node-version: 18
    - run: npm i pagefind
    - run: npx pagefind --source public --bundle-dir search
  ```

* å°è¯•è¿è¡Œå¹¶æŸ¥çœ‹æ•ˆæœ:

  ```shell
  git add .
  git commit -m "add search function"
  git push -u origin master
  ```

  ç­‰å¾…å‡ åˆ†é’Ÿåéƒ¨ç½²æˆåŠŸå,åœ¨æµè§ˆå™¨é€šè¿‡åŸŸåè®¿é—® https://www.yolichan.fun/zh/search/å°±èƒ½çœ‹åˆ°æœç´¢é¡µé¢å•¦:

  ![image-20230806213742990](https://cdn.jsdelivr.net/gh/mewoooew/picGO@main/images/hugo-pagefind-result-page.png)

### åè®°

å†™ä¸åŠ¨äº†...ä¸‰æœˆçš„æ—¶å€™å¥½åƒå°±æ˜¯å› ä¸ºæœ¬åœ°è°ƒè¯•çš„æ—¶å€™æ€»æ˜¯çœ‹ä¸åˆ°æœç´¢æ¡†, ä»¥ä¸ºå¡bugäº†, ä¸€ç›´æ²¡æœ‰èµ°å‡ºæ¥, è¿`fuse.js`ä¹Ÿå»å°è¯•ä½¿ç”¨äº†ä¸€ä¸‹, æ— æœğŸ˜¢ğŸ˜¢ğŸ˜¢. è¿™æ¬¡ä¸€è¾¹é…ç½®, è¿˜å–œæ¬¢é¡ºæ‰‹ç©ä¸€ä¸‹`GitHub Action`çš„ä¸€é”®å‘å¸ƒåŠŸèƒ½, ä¸€æ¬¡é¡ºæ‰‹éƒ¨ç½²å®Œä¹‹å, æ— æ„ä¸­å‘ç°èƒ½åœ¨ç½‘é¡µç«¯çœ‹åˆ°æœç´¢æ¡†äº†,æ‰æç„¶å¤§é›¾(å¯¹, å¤§é›¾, å› ä¸ºä¾ç„¶ä¸æ¸…æ¥šè¿™æ˜¯ä¸ªä»€ä¹ˆåŸç†)è‹¦æ¶©, ä½†æ˜¯å¼€å¿ƒ, è§£å†³äº†å°ç«™ä¸€å¤§bug, å‘œå‘œå‘œ.
